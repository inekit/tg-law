deploy-stage:
  image: lotygerodistribution/docker-compose
  stage: deploy
  tags:
    - docker
  environment:
    name: stage-deploy
    url: https://meta-forest.stage.dev.metafora.dev
  variables:
    COMPOSE_TEMP_PATH: ".tmp"

    DOCKER_SWARM_HOST: "${DOCKER_SWARM_HOST}"

    META_FOREST_BOT_SUBSCRIPTION_CHECKER_DB_PASSWORD: "${META_FOREST_BOT_SUBSCRIPTION_CHECKER_DB_PASSWORD}"
    META_FOREST_BOT_SUBSCRIPTION_CHECKER_BOT_TOKEN: "${META_FOREST_BOT_SUBSCRIPTION_CHECKER_BOT_TOKEN}"
    META_FOREST_BOT_SUBSCRIPTION_CHECKER_ADD_CHAT_ID: "${META_FOREST_BOT_SUBSCRIPTION_CHECKER_ADD_CHAT_ID}"
    META_FOREST_BOT_SUBSCRIPTION_CHECKER_CHAT_ID: "${META_FOREST_BOT_SUBSCRIPTION_CHECKER_CHAT_ID}"
    META_FOREST_BOT_SUBSCRIPTION_CHECKER_PRIVATE_CHAT_ID: "${META_FOREST_BOT_SUBSCRIPTION_CHECKER_PRIVATE_CHAT_ID}"

  script:
    - "./bin/docker-compose-render.sh"
    - "./bin/docker-registry-login.sh"
    - "./bin/docker-compose-pull.sh"
    - "./bin/docker-swarm-networks.sh"
    - "./bin/docker-swarm-deploy.sh"
